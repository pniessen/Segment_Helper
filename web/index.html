<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Rosetta Consulting Segment Helper</title>

    <!-- Bootstrap Core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/static/css/grayscale.css" rel="stylesheet">

    <!--- Bootstrap-Switch CSS http://www.bootstrap-switch.org/ -->
<!--     <link href="/static/css/bootstrap.css" rel="stylesheet"> -->
    <link href="/static/css/bootstrap-switch.css" rel="stylesheet">

    <!--- Dragula CSS -->
    <link href='static/css/dragula.min.css' rel='stylesheet' type='text/css' />
<!--     <link href='static/css/example.css' rel='stylesheet' type='text/css' /> -->
    
    <!-- Custom Fonts -->
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <style type="text/css">
    .tg  {border-collapse:collapse;border-spacing:0;}
    .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg .tg-yw4l{vertical-align:top}
    
    /* Sortable tables */
    /*style sheet from http://www.jankoatwarpspeed.com/wp-content/uploads/examples/expandable-rows/*/
    table.sortable thead {
    background-color:#eee;
    color:#666666;
    font-weight: bold;
    cursor: default;
    }

    table.center {
    margin-left:auto; 
    margin-right:auto;
    td { background:#C7DDEE none repeat-x scroll center left; color:#000; padding:7px 15px; }
    tr td { background:#fff url(static/row_bkg.png) repeat-x scroll center left; cursor:pointer; }
    }
    
    /*body { font-family:Arial, Helvetica, Sans-Serif; font-size:0.8em;}*/
    #table-goes-here { border-collapse:collapse;}
    #table-goes-here h4 { margin:0px; padding:0px;}
    #table-goes-here img { float:right;}
    #table-goes-here ul { margin:10px 0 10px 40px; padding:0px;}
    #table-goes-here th { background:#7CB8E2 url(static/header_bkg.png) repeat-x scroll center left; color:#fff; padding:7px 15px; text-align:left;}
    #table-goes-here td { background:#C7DDEE none repeat-x scroll center left; color:#000; padding:7px 15px; }
    #table-goes-here tr td { background:#fff url(static/row_bkg.png) repeat-x scroll center left; cursor:pointer; }
    #table-goes-here div.arrow { background:transparent url(arrows.png) no-repeat scroll 0px -16px; width:16px; height:16px; display:block;}
    #table-goes-here div.up { background-position:0px 0px;}
    #table-goes-here  { margin-left:auto; margin-right:auto;}
    
    #tracker-goes-here { font-family:Arial, Helvetica, Sans-Serif; font-size:0.8em;}
    #tracker-goes-here { border-collapse:collapse;}
    #tracker-goes-here h4 { margin:0px; padding:0px;}
    #tracker-goes-here img { float:right;}
    #tracker-goes-here ul { margin:10px 0 10px 40px; padding:0px;}
    #tracker-goes-here th { background:#7CB8E2 url(static/header_bkg.png) repeat-x scroll center left; color:#fff; padding:1px 4px; text-align:left;}
    #tracker-goes-here td { background:#C7DDEE none repeat-x scroll center left; color:#000; padding:1px 4px; }
    #tracker-goes-here tr td { background:#fff url(static/row_bkg.png) repeat-x scroll center left; cursor:pointer; }
    #tracker-goes-here div.arrow { background:transparent url(arrows.png) no-repeat scroll 0px -16px; width:16px; height:16px; display:block;}
    #tracker-goes-here div.up { background-position:0px 0px;}
    #tracker-goes-here  { margin-left:auto; margin-right:auto;}
    </style>
    <style>

    .btn-file {
      position: relative;
      overflow: hidden;
    }
    .btn-file input[type=file] {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 100%;
      min-height: 100%;
      font-size: 100px;
      text-align: right;
      filter: alpha(opacity=0);
      opacity: 0;
      background: red;
      cursor: inherit;
      display: block;
    }
    

    input[readonly] {
      background-color: white !important;
      cursor: text !important;
      color: black; 
    }

    .container2 {
    float: left;
    width: 25%;
    margin-right: 2%;
    padding: 10px;
    min-height: 300px;
    background-color: rgba(255, 0, 0, 0.2);
    transition: opacity 0.4s ease-in-out;
    }
    .container2 div {
    padding: 10px 15px;
    margin: 10px 0;
    background-color: rgba(255, 0, 0, 0.2);
    }
    }
</style>
</head>

<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

    <!-- Navigation -->
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="#scorecard" onclick="GetTrackerData(), GetTrainingData()">
                    <i class="fa fa-play-circle"></i>  <span class="light">Start</span> Segment Helper
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                <ul class="nav navbar-nav">
                    <!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#about">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#settings">Control Panel</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#explorer">Explorer</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#run-tracker">Run Tracker</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#scorecard">Scorecard</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Intro Header -->
    <header class="intro">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-md-offset-2">
                        <h1> Rosetta Segment Helper (Beta)</h1>
                        <!-- <h2>Rosetta Segment Helper</h2> -->
                        <p class="intro-text">A simple tool to explore segmenting using survey data<br></p>
                        <a href="#about" class="btn btn-circle page-scroll">
                            <i class="fa fa-angle-double-down animated"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- About Section -->
    <section id="about" class="container content-section text-center">
        <div class="row">
            <div class="col-md-3">
                <h2>Classic Mode:</h2>
                <li><p>Load data file</p></li>
                <li><p>Choose variables to segment by</p></li>
                <li><p>Review results</p></li>
                <li><p>Repeat</p></li>
                <a href="#settings" class="btn btn-circle page-scroll">
                    <i class="fa fa-angle-double-down animated"></i>
                </a>
            </div>
            <div class="col-md-3">
                    <h2>"Plus" mode:</h2>
                    <li><p>Load data file</p></li>
                    <li><p>Segment Helper suggests cluster seed</p></li>
                    <li><p>Review results</p></li>
                    <li><p>Repeat</p></li>
                <a href="#settings" class="btn btn-circle page-scroll">
                    <i class="fa fa-angle-double-down animated"></i>
                </a>
            </div>
            <div class="col-md-4">
                    <h2>"Grid" mode:</h2>
                    <li><p>Load data file</p></li>
                    <li><p>Segment Helper suggests cluster seed, runs grid search</p></li>
                    <li><p>Review results</p></li>
                    <li><p>Repeat</p></li>
                <a href="#settings" class="btn btn-circle page-scroll">
                    <i class="fa fa-angle-double-down animated"></i>
                </a>
            </div>
        </div>
    </section>
    
    <!-- Settings Section -->
        <section id="settings" class="container content-section ">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                    <h2>Settings</h2>
                    <form id="upload-file" method="post" enctype="multipart/form-data">
                        <fieldset>
                            <label for="file">Select a file</label>
                            <input name="file" type="file">
                            <button id="upload-file-btn" type="button">Upload</button>
                        </fieldset>
                    </form>                   
                    <p>Load data:    
                        <div class="input-group">
                            <span class="input-group-btn">
                                <span class="btn btn-primary btn-file">
                                    Browse&hellip; <input type="file" multiple>
                                </span>
                            </span>
                            <input type="text" class="form-control" readonly>
                        </div>
                    <p>Number of clusters: <input type="text" style="color:black" color="black" value="6"</p>
                    <p>Export to Excel (yes/no)  <input type="checkbox" name="xls-checkbox" ></p>
                    <p>Grid search (yes/no)  <input type="checkbox" name="gridsearch-checkbox" ></p>
                    <form name="gridsearch">
                        <ul>
                            <li><h6>Grid depth (+/- clusters):<input type="text" name="num-clusters" value="3" style="color:black"><br></h6></li>
                            <li><h6>Grid width (+/- variables):<input type="text" name="num-variables" value="5" style="color:black"></h6></li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>
        </section>
   <!-- Explorer Section -->
   <!-- see http://jsfiddle.net/TylerODonnell/h42w6t8j/ -->
  <!--  also see http://v4-alpha.getbootstrap.com/components/buttons/ -->
        <section id="explorer" class="container content-section text-center">

            Cats:  <input name="animal" type="checkbox" value="Cats" id = "box1">
            Dogs:  <input name="animal" type="checkbox" value="Dogs" id = "box2">

        <div class="row"><h2>Explorer</h2>
            <div class="col-md-6"><h4>Pick the questions for clustering:</h4></div>
<!--             <div class="col-md-1">2</div>
            <div class="col-md-1">3</div>
            <div class="col-md-1">4</div>
            <div class="col-md-1">5</div>
            <div class="col-md-1">6</div> -->
            <div class="col-md-1"></div>
            <div class="col-md-1"><button type="button" class="btn btn-primary"><i class="fa fa-play-circle"></i><a id="link-portfolio" href="#run-tracker" onclick="SubmitData()">Go!</button></a></div>
            <div class="col-md-1">                <div class="dropdown open">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    # Seg
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                    <button class="dropdown-item" type="button" style="color:black">1</button>
                    <button class="dropdown-item" type="button" style="color:black">2</button>
                    <button class="dropdown-item" type="button" style="color:black">3</button>
                    <button class="dropdown-item" type="button" style="color:black">4</button>
                    <button class="dropdown-item" type="button" style="color:black">5</button>
                    <button class="dropdown-item" type="button" style="color:black">6</button>
                    <button class="dropdown-item" type="button" style="color:black">7</button>
                    <button class="dropdown-item" type="button" style="color:black">8</button>
                  </div>
                </div>
            </div>
            <div class="col-md-1">                <div class="dropdown open">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-play-circle fa-flip-horizontal"></i> Rewind</button>
                     <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                    <button class="dropdown-item" type="button" style="color:black">R1</button>
                    <button class="dropdown-item" type="button" style="color:black">R2</button>
                    <button class="dropdown-item" type="button" style="color:black">R3</button>
                    <button class="dropdown-item" type="button" style="color:black">R4</button>
                    <button class="dropdown-item" type="button" style="color:black">R5</button>
                    <button class="dropdown-item" type="button" style="color:black">R6</button>
                    <button class="dropdown-item" type="button" style="color:black">R7</button>
                    <button class="dropdown-item" type="button" style="color:black">R8</button>
                  </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 col-lg-offset-1">
                    <div class="container2" id = 'explorer-left'> 
                        <h5>Potential Variables</h5>
                            <div id='ex-a'>q_01: I like cheese</div>
                        <!-- </div> -->
                    </div>
                    <div class="container2" id="explorer-right"><h5>Variables to use in this run</h5></div>
                    <div class="container2 text-left" id="right2"><h5>Results</h5><class="text-left"><p>
                        <h6>Metric 1:</h6>
                        <h6>Metric 2:</h6>
                        <h6>Metric 3:</h6>
                        <h6>Metric 4:</h6>
                    </div>
                </div>     
            </div>
       </section>

    <!-- Run Tracker Section -->
        <section id="run-tracker" class="container content-section text-center">
            <h2>Run Tracker</h2>
            <table class="tg" class="sortable" id = 'myTracker' >
            <div id="tracker-goes-here" class = "center">
                <td>Cats:  <input name="animal" type="checkbox" value="Cats" id = "box3"></td>
                <td>Dogs:  <input name="animal" type="checkbox" value="Dogs" id = "box4"></td>
            </div> 
            </table>
        </section>
    
    <!-- Scorecard Section --> 
        <section id="scorecard" class="content-section text-center">
            <h2>Cluster Scorecard</h2>
            <table class="tg" class="sortable" id = 'myTable' >
            <div id="table-goes-here" class = "center"></div> 
            </table>
        <!-- <ul id="navigation">
            <li><a id="link-portfolio" href="#data" onclick="GetTrainingData()">See Data</a></li>
        </ul> -->
        </section>

    <!-- Contact Section -->
    <section id="contact" class="container content-section text-center">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
                <h2>Contact Us!</h2>
                <p>Feel free to email us to provide some feedback!</p>
                <p><a href="mailto:peter.niessen@rosetta.com">peter.niessen@rosetta.com</a></p>
                <p><a href="mailto:matt.dietly@rosetta.com">matt.dietly@rosetta.com</a></p>
            </div>
        </div>
    </section>

    <!-- Map Section -->
<!--     <div id="map"></div> -->

    <!-- Footer -->
    <footer>
        <div class="container text-center">
            <p>Copyright &copy; Your Website 2014</p>
        </div>
    </footer>
    <!-- Please wait dialog for ajax POST call -->
    <!-- http://stackoverflow.com/questions/2509711/display-loading-image-while-post-with-ajax -->
    <!-- http://dotnetspeak.com/2013/05/creating-simple-please-wait-dialog-with-twitter-bootstrap -->
<!--     <section>
        <div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false" style='display:none'>
            <div class="modal-header">
                <h1>Processing...</h1>
            </div>
            <div class="modal-body">
                <div class="progress progress-striped active">
                    <div class="bar" style="width: 100%;"></div>
                </div>
            </div>
        </div>
    </section> -->
    <!-- jQuery -->
    <script src="static/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="static/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="static/js/jquery.easing.min.js"></script>

    <!-- Google Maps API Key - Use your own API key to enable the map feature. More information on the Google Maps API can be found at https://developers.google.com/maps/ -->
    <!--     // <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRngKslUGJTlibkQ3FkfTxj3Xss1UlZDA&sensor=false"></script> -->

    <!-- Custom Theme JavaScript -->
    <script src="static/js/grayscale.js"></script>
    
    <!-- Sorttable -->
    <script src="http://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    
    <!-- Bootstrap-Switch (http://www.bootstrap-switch.org/) -->
    <script src="/static/js/bootstrap-switch.js"></script>

    <!-- Bootstrap - Switch -->
    <script>
    $("[name='gridsearch-checkbox']").bootstrapSwitch();
    $("[name='xls-checkbox']").bootstrapSwitch();
 
    </script>
    <!-- box check event handler -->
    <script>
    $("[name='animal']").change(function() {
    console.log("Handler for .change() called.");
    alert( "Handler for .change() called." );
    });
    </script>
    <!-- Grid Search parameters on? -->
    <script>
    // document.forms['gridsearch']['num-clusters'].disabled = true;
    // document.forms['gridsearch']['num-variables'].disabled = true;
    
    // //http://stackoverflow.com/questions/31345638/bootstrap-switch-change-state-after-clicking-on-button?rq=1
    // $("[name='gridsearch-checkbox']").on('switchChange.bootstrapSwitch', function () {
    //     console.log('in grid search switch function'); 
    //     if ($('[name="gridsearch-checkbox"]').is(':checked')){ 
    //     // alert('checked');
    //     console.log('grid search activated');
    //     document.forms['gridsearch']['num-clusters'].disabled = false;
    //     document.forms['gridsearch']['num-variables'].disabled = false;
    //     } 
    //     else { 
    //     // alert('not checked');
    //     console.log('grid search deactivated');
    //     };
    // });
    </script>
    <script>
    // turns on / off waiting screen
    // http://dotnetspeak.com/2013/05/creating-simple-please-wait-dialog-with-twitter-bootstrap
    // http://jsfiddle.net/terryr2015/qzzxuuj7/
    // on: myApp.showPleaseWait();
    // off: myApp.hidePleaseWait();
    var myApp;
    myApp = myApp || (function () {
        var pleaseWaitDiv = $('<div class="modal fade" style=top:40% id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" style="color:black" >Processing - please wait...</h4></div><div class="modal-body"><div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div></div></div></div></div>');
        return {
            showPleaseWait: function () {
                pleaseWaitDiv.modal();
            },
            hidePleaseWait: function () {
                pleaseWaitDiv.modal('hide');
            },

        };
    })();
    </script>
   
    <!--  which boxes in run_tracker have been checked?  -->
    <script>
    // Pass the checkbox name to the function
    function getCheckedBoxes(chkboxName) {
      var checkboxes = document.getElementsByName(chkboxName);
      var checkboxesChecked = [];
      // loop over them all
      for (var i=0; i<checkboxes.length; i++) {
         // And stick the checked ones onto an array...
         if (checkboxes[i].checked) {
            checkboxesChecked.push(checkboxes[i].value);
         }
      }
      // Return the array if it is non-empty, or null
      return checkboxesChecked.length > 0 ? checkboxesChecked : null;
    }

    // Call as
    var checkedBoxes = getCheckedBoxes("mycheckboxes");
    </script>

    <!-- Load scorecard table data -->
    <script>
    function GetTrainingData () {

        console.log('in GetTrainingData function');

        $.ajax({
             type: "GET",
             contentType: "application/json; charset=utf-8",
             url: "/data",
             dataType: "json",
             async: true,
             //data: data_to_send,
             success: function (training_data) {console.log(training_data);
                                        //MakeTable(training_data);
                                        createTable(training_data);
                                        //loadTrainingImage(training_data);
             },
             error: function (training_data) {console.log(training_data);
            }
           });
    };      
    </script>
<script>
function SubmitData () {

    console.log('in SubmitData function');  

    // var explorer_ids = getExplorerIds();
    var checkbox_ids = getCheckedBoxes('tcheck');
    var num_segments = 6;

    // var data_to_send = checkbox_ids;

    //var data_to_send = '{"example": [154]}'
    // var checkbox_id = [1,2,3,4];
    // var checkbox_ids = checkbox_id.toString();
    // var explorer_ids = explorer_id.toString();

    var data_to_send = "{\"questions\":\"[" + checkbox_ids + "]\", \"segments\":[6]}";

    // var data_to_send = "{\"questions\":" + checkbox_ids + ", \"segments\":" + num_segments + "}";
    console.log(data_to_send, checkbox_ids);      

    //$('#pleaseWaitDialog').show(); // show loading message
    myApp.showPleaseWait();
    $.ajax({
         type: "POST",
         contentType: "application/json; charset=utf-8",
         url: "/submit_data",
         dataType: "json",
         async: true,
         // data: "{\"keywords\": \"romantic,beer,family\", \"neighborhoods\":\"\", \"cuisines\":\"Sushi\"}",
         data: data_to_send,
         success: function (data) {console.log(data);
                                myApp.hidePleaseWait();
                                UpdateTrackerData ();
                                GetTrainingData();
                                // myApp.hidePleaseWait();
                                // $('#pleaseWaitDialog').hide(); //hide loading message
                                    // MakeATable(data);
                                    // console.log('table made');
                                    // loadImage(data);
                                    // console.log('images loaded');
                                    // mapRecommendations(data);
                                    // console.log('locations plotted');
                                    // MakeHeatChart(data);
                                    // MakeAWildCardTable(data);
                                    // loadWildCardImage(data);
                                    // mapWildCardRecommendations(data); 
         },
         error: function (result) {console.log(data);
        }
       });
    };
</script>

    <!-- create scorecard_table -->
    <script>
    function createTable(training_data){
         
        mytable = $('<table></table>').attr({ id: "basicTable" }).attr({class: 'tg center table-goes-here'});
        var rows = training_data.training.length;
        console.log (rows);
        //var rows = new Number($("#rowcount").val());
        //var cols = new Number($("#columncount").val());
        //var cols = training_data.training[0].length
        var cols = 8;
        var tr = [];
        var header_row = $('<tr></tr>').appendTo(mytable);
        header_row.append("<th>Run ID</th>");
        header_row.append("<th>Clusters</th>");
        header_row.append("<th>Variables</th>");
        header_row.append("<th>MLE</th>");
        header_row.append("<th>Chi-Sq</th>");
        header_row.append("<th>BIC</th>");
        header_row.append("<th>Cohesiveness</th>");
        header_row.append("<th>Differentiation</th>");
        for (var i = 0; i < rows; i++) {
            //var row = $('<tr></tr>').attr({ class: ["class1", "class2", "class3"].join(' ') }).appendTo(mytable);
            var row = $('<tr></tr>').appendTo(mytable);
            row.append("<td>" + training_data.training[i].a + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].b + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].c + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].d + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].e + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].f + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].g + "</td>").attr({id:'table-' + (i+1) + '-1'});
            row.append("<td>" + training_data.training[i].h + "</td>").attr({id:'table-' + (i+1) + '-1'});
            //for (var j = 0; j < cols; j++) {
                //$('<td></td>').text("text1").attr({id:'table-'+ (i+1) + "-" + (j+1)}).appendTo(row); 
            //}
                     
        }
        //console.log("TTTTT:"+mytable.html());
        mytable.appendTo("#table-goes-here");          
      
      var newTableObject = document.getElementById('basicTable');
      sorttable.makeSortable(newTableObject);
    }

    </script>

    <script>
    function UpdateTrackerData () {

        console.log('in UpdateTrackerData function');

        $.ajax({
             type: "GET",
             contentType: "application/json; charset=utf-8",
             url: "/tracker",
             dataType: "json",
             async: true,
             //data: data_to_send,
             success: function (tracker_data) {console.log(tracker_data);
                                        //MakeTable(training_data);
                                        // createTracker(tracker_data);
                                        appendColumn(tracker_data);
                                        //loadTrainingImage(training_data);
             },
             error: function (tracker_data) {console.log(tracker_data);
            }
           });
    };      
    </script>

    <script>
    function StartTrackerData () {

        console.log('in StartTrackerData function');

        $.ajax({
             type: "GET",
             contentType: "application/json; charset=utf-8",
             url: "/create_tracker",
             dataType: "json",
             async: true,
             //data: data_to_send,
             success: function (first_tracker_data) {console.log(first_tracker_data);
                                        //MakeTable(training_data);
                                        startTracker(first_tracker_data);
                                        fillExplorer(first_tracker_data);
                                        //loadTrainingImage(training_data);
             },
             error: function (first_tracker_data) {console.log(first_tracker_data);
            }
           });
    };      
    </script>

    <!-- create tracker_table -->
    <script>
    function createTracker(tracker_data){
         
        mytable = $('<table></table>').attr({ id: "trackerTable" }).attr({class: 'tg center table-goes-here'});
        var rows = tracker_data.tracker.length;
        console.log (rows);
        //var rows = new Number($("#rowcount").val());
        //var cols = new Number($("#columncount").val());
        var cols =  Object.keys(tracker_data.tracker[0]).length;
        var cols_names = Object.keys(tracker_data.tracker[0]);
        //console.log (cols);
        //console.log (cols_names);
        //console.log(cols_names[0]);
        var header_row = $('<tr></tr>').appendTo(mytable);
        header_row.append("<th>" + "</th>");
        for (var h = 0; h < cols; h++) {//var cols = 15;
        // var tr = [];
            // var header_row = $('<tr></tr>').appendTo(mytable);
            var header_name = cols_names[h];
            if (h < 11) {header_name = cols_names[h].slice(4)};
            console.log(header_name);
            $('<th></th>').text(header_name).appendTo(header_row);}
        // header_row.append("<th>Q#</th>");

        for (var i = 0; i < rows; i++) {
            //var row = $('<tr></tr>').attr({ class: ["class1", "class2", "class3"].join(' ') }).appendTo(mytable);
            var row = $('<tr></tr>').appendTo(mytable);
            var cols_names = Object.keys(tracker_data.tracker[i]);
            row.append("<td><input type='checkbox'>" + "</td>").attr({id:'ttable-' + (i+1) + '-0'});
            // row.append("<td>" + tracker_data.tracker[i].b + "</td>").attr({id:'ttable-' + (i+1) + '-1'});
  
            for (var j = 0; j < cols; j++) {
                //console.log (cols_names);
                //console.log(tracker_data.tracker[i])
                //console.log(tracker_data.tracker[i][cols_names[j]])
                if (j == 0) {$('<td></td>').text(tracker_data.tracker[i][cols_names[j]]).attr({id:'ttable-'+ (i+1) + "-" + (j+1)}).appendTo(row);}
                else {$('<td></td>').text(tracker_data.tracker[i][cols_names[j]]).attr({id:'ttable-'+ (i+1) + "-" + (j+1)}).appendTo(row);}
                // $('<td></td>').text(tracker_data.tracker[i][cols_names[j]]).attr({id:'ttable-'+ (i+1) + "-" + (j+1)}).appendTo(row); 
            }
                     
        }

        
        //console.log("TTTTT:"+mytable.html());
        mytable.appendTo("#tracker-goes-here");          
      
      var newTableObject2 = document.getElementById('trackerTable');
      sorttable.makeSortable(newTableObject2);
    }

    </script>
    <script>
    var original_question_order = [];
    function startTracker(first_tracker_data){
        
        console.log('in startTracker function'); 
        mytable = $('<table></table>').attr({ id: "trackerTable" }).attr({class: 'tg center table-goes-here'});
        var rows = first_tracker_data.tracker.length;
        console.log (rows);
        //var rows = new Number($("#rowcount").val());
        //var cols = new Number($("#columncount").val());
        var cols =  Object.keys(first_tracker_data.tracker[0]).length;
        var cols_names = Object.keys(first_tracker_data.tracker[0]);
        // var orig_question_order = [];
        //console.log (cols);
        //console.log (cols_names);
        //console.log(cols_names[0]);
        var header_row = $('<tr></tr>').appendTo(mytable);
        header_row.append("<th>" + "</th>");
        for (var h = 0; h < cols; h++) {//var cols = 15;
        // var tr = [];
            // var header_row = $('<tr></tr>').appendTo(mytable);
            var header_name = cols_names[h];
            if (h < 11) {header_name = cols_names[h].slice(4)};
            console.log(header_name);
            $('<th></th>').text(header_name).appendTo(header_row);}
        // header_row.append("<th>Q#</th>");

        for (var i = 0; i < rows; i++) {
            //var row = $('<tr></tr>').attr({ class: ["class1", "class2", "class3"].join(' ') }).appendTo(mytable);
            var row = $('<tr></tr>').appendTo(mytable);
            var cols_names = Object.keys(first_tracker_data.tracker[i]);
            var check_label = first_tracker_data.tracker[i][cols_names[0]];
            // var cell = $('<td></td>').appendTo(row);
            // cell.append('<input type="checkbox" value="xyz">');
            // console.log(cell);
            // row.append('<td></td>');
            // row.append('<input name="animal" type="checkbox">')
            row.append('<td><input type="checkbox" name = "tcheck" value="' + check_label + '" id="'+check_label+'"></td>').attr({id:'rtable-' + check_label});//attr({id:'ztable-' + (i+1) + '-0'});
            original_question_order[i] = check_label;
            // row.append("<td>" + tracker_data.tracker[i].b + "</td>").attr({id:'ttable-' + (i+1) + '-1'});
            for (var j = 0; j < cols; j++) {
                //console.log (cols_names);
                //console.log(tracker_data.tracker[i])
                //console.log(tracker_data.tracker[i][cols_names[j]])
                $('<td></td>').text(first_tracker_data.tracker[i][cols_names[j]]).attr({id:'ttable-'+ (i+1) + "-" + (j+1)}).appendTo(row); 
            }
                     
        }

        
        //console.log("TTTTT:"+mytable.html());
        mytable.appendTo("#tracker-goes-here");          
      
      var newTableObject2 = document.getElementById('trackerTable');
      sorttable.makeSortable(newTableObject2);
    }
    </script>
    <!--     check box event handler -->
    <script>
    // Get the element, add a click listener...
    var sophie = document.getElementById('q39_8');
    console.log('sophie', sophie);
    document.getElementById('q39_8').addEventListener("change", function(e) {
        console.log('item clicked', e.target.nodeName, e.target.nodeValue);
    });
    </script>
    <!-- append explorer data to div = "explorer-left" -->
    <script>
    // http://stackoverflow.com/questions/14004117/create-div-and-append-div-dynamically
    function fillExplorer(first_tracker_data){
        // var num_questions = first_tracker_data.tracker.length;
        var num_questions = 10;
        var right_div = document.getElementById('explorer-left');
        for (i = 0; i < num_questions; i++) {
            var cols_names = Object.keys(first_tracker_data.tracker[i]);
            var question_name = first_tracker_data.tracker[i][cols_names[0]];
            console.log(question_name);
            var innerDiv = document.createElement('div');
            innerDiv.textContent = question_name; 
            innerDiv.id = question_name;
            right_div.appendChild(innerDiv);
        }
        var innerDiv = document.createElement('div');
        innerDiv.className = 'block-2';
        innerDiv.textContent = "New text"; 
        right_div.appendChild(innerDiv);
    };
    </script>

    <!-- Load data -->
    <script>
    // http://www.abeautifulsite.net/whipping-file-inputs-into-shape-with-bootstrap-3/
    // also consider http://markusslima.github.io/bootstrap-filestyle/

    // $(document).on('change', '.btn-file :file', function() {
    //   var input = $(this),
    //       numFiles = input.get(0).files ? input.get(0).files.length : 1,
    //       label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
    //   input.trigger('fileselect', [numFiles, label]);
    // });

    // $(document).ready( function() {
    //     $('.btn-file :file').on('fileselect', function(event, numFiles, label) {
            
    //         var input = $(this).parents('.input-group').find(':text'),
    //             log = numFiles > 1 ? numFiles + ' files selected' : label;
    //             console.log (log);
            
    //         if( input.length ) {
    //             input.val(log);
    //         } else {
    //             if( log ) alert(log);
    //         }
            
    //     });
    // });
</script>
<script src='static/js/dragula.min.js'></script>
<!-- <script src='static/js/example.min.js'></script> -->

<script>
var dragAndDrop = {

    limit: 10,
    count: 0,
    
    init: function () {
        this.dragula();
        this.eventListeners();
    },
    eventListeners: function () {
        this.dragula.on('drop', this.dropped.bind(this));
    },
    dragula: function () {
        this.dragula = dragula([document.querySelector('#explorer-left'), document.querySelector('#explorer-right')],
        {
            moves: this.canMove.bind(this),
            copy: true,
        });
    },
    canMove: function () {
        return this.count < this.limit;
    },
    dropped: function (el) {
        this.count++;
    }
};

dragAndDrop.init();

</script>
<!-- Upload file -->
<script>
// http://stackoverflow.com/questions/18334717/how-to-upload-a-file-using-an-ajax-call-in-flask
// https://github.com/moremorefor/flask-fileupload-ajax-example/blob/master/app.py
$(function() {
    $('#upload-file-btn').click(function() {
        var form_data = new FormData($('#upload-file')[0]);
        $.ajax({
            type: 'POST',
            url: '/upload',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            async: false,
            success: function(data) {
                console.log('Success!');
            },
        });
    });
});
</script>
<script>
// http://www.redips.net/javascript/adding-table-rows-and-columns/
// append row to the HTML table

function appendRow() {
    var tbl = document.getElementById('my-table'), // table reference
        row = tbl.insertRow(tbl.rows.length),      // append table row
        i;
    // insert table cells to the new row
    for (i = 0; i < tbl.rows[0].cells.length; i++) {
        createCell(row.insertCell(i), i, 'row');
    }
}
 
// create DIV element and append to the table cell
function createCell(cell, text, i, style) {
    console.log(cell, text, i, style);
    var div = document.createElement('div'), // create DIV element
        txt = document.createTextNode(text), // create text node
        col = document.getElementById('trackerTable').rows[0].cells.length;
    console.log(col);
    div.appendChild(txt);                    // append text node to the DIV
    div.setAttribute('class', style);        // set DIV class attribute
    div.setAttribute('className', style);    // set DIV class attribute for IE (?!)
    cell.setAttribute('id', 'ttable-'+ (i) + "-" + (col));  // set id for new cell
    cell.appendChild(div);                   // append DIV to the table cell
    // console.log(cell);
}
// append column to the HTML table
// http://stackoverflow.com/questions/1793046/is-it-possible-to-create-a-th-with-tablerow-insertcell
// http://stackoverflow.com/questions/14999927/insert-th-in-thead
// http://stackoverflow.com/questions/10043760/javascript-count-number-of-columns-in-a-table-row

function appendColumn(tracker_data) {
    console.log('in appendColumn function');
    var tbl = document.getElementById('trackerTable'), // table reference
        row_list = document.getElementsByTagName('tr')//.attr('id'),
        one_row = row_list[1],
        current_question_order = [],
        i;
        // one_row_id = getAttributeByIndex(one_row, 0),
    // console.log (one_row, one_row.length)

    for (var z = 1; z < row_list.length-1; z++) {
    console.log('id',row_list[z].id.slice(7));
    current_question_order[z] = row_list[z].id.slice(7);
    };
        // row_list_row = row_list.getElementsByTagName('tr'),
        // row_ids = row_list.getAttribute('id'),
        // http://www.w3schools.com/jsref/jsref_indexof_array.asp
        // i;
    console.log('row_list_id: ', current_question_order.length, current_question_order);
    // var header2 = tbl.rows[0].cells.length;

    // var header = document.getElementById('trackerTable').rows[0].cells.length;
    // console.log (header2);
    // var tr = document.getElementById('trackerTable').tHead.children[0];
    // th = document.createElement('th');
    // th.innerHTML = "New";
    // console.log(th);
    // console.log(tr);
    // tr.appendChild(th);
    
    // open loop for each row and append cell
    var num_new_cols =  Object.keys(tracker_data.tracker[0]).length;
    var keys = Object.keys(tracker_data.tracker[0]);
    var col_num = tbl.rows[0].cells.length;
    // var num_new_cols =  10
    for (j = 0; j < num_new_cols; j++) {
        // var tr = tbl.tHead.children[0];
        // th = document.createElement('th');
        // th.innerHTML = "New";
        // tr.appendChild(th);

        for (i = 0; i < tbl.rows.length - 1; i++) {
            console.log(tbl.rows.length);   
            if (i == 0) {console.log('header_row');
            // var tr = document.getElementById('trackerTable').tHead.children[0];
            // var tr = tbl.tHead.children[0];
            // var keys = Object.keys(tracker_data.tracker[0]);
            // console.log(keys);
            // th = document.createElement('th');
            // th.innerHTML = keys[j];
            // th.innerHTML = "New";
            // tr.appendChild(th);
            //var keys = Object.keys(tracker_data.tracker[0]);
            var txt = tracker_data.tracker[i][keys[j]]; 
            console.log(i,j,keys,txt)
            var x = tbl.rows[i].insertCell(-1);
            // var col_num = tbl.rows[0].cells.length;
            x.outerHTML = ('<th id="ttable-'+ i + '-' + col_num + '">' + keys[j] + '</th>');
            // x.setAttribute('id', 'ttable-'+ (i) + "-" + (col_num-1));
            // createCell(tbl.rows[i+1].insertCell(tbl.rows[i+1].cells.length), txt, i, 'col');
            }
            // $('<th></th>').text('xx').appendTo(tbl);}
            // if (i = 0) {$('<th></th>').text('xx').appendTo(tbl);}
            // else {
            // var keys = Object.keys(tracker_data.tracker[0]);
            // original_question_order (=inbound data) match to row_id_list (current table state) as key?
            var old_to_new_mapping = current_question_order.indexOf(original_question_order[i]);
            // console.log('original_question_order:', original_question_order[i], "row_list_id: ", current_question_order[i+1]);
            // console.log('equality check:', original_question_order[i]==current_question_order[i+1]);
            // console.log('old-to-current mapping: ', current_question_order.indexOf(original_question_order[i]));
            // console.log('confirm mapping:', current_question_order[old_to_new_mapping]);
            var txt = tracker_data.tracker[i][keys[j]];
            // var x = tbl.rows[i+1].insertCell(-1); // use when sortTable = false
            var x = tbl.rows[old_to_new_mapping].insertCell(-1); // use when sortTable = true
            // var col_num = tbl.rows[0].cells.length;
            x.innerHTML = txt;
            x.setAttribute('id', 'ttable-'+ (i+1) + "-" + (col_num-1));
            // console.log(i,j,keys,txt);
            // createCell(tbl.rows[i+1].insertCell(tbl.rows[i+1].cells.length), txt, i, 'col');
            // } // else
        } // inner loop (= i)
    } // outer loop (= j)
}; 
</script>
<script>
// http://stackoverflow.com/questions/27629122/how-to-get-all-ids-inside-of-a-div-using-pure-javascript
function getExplorerIds () {
    console.log('in getExplorerIds function')
    var explorer_left_ids = [];
    var explorer_right_ids = [];
    var explorer_left_children = document.getElementById("explorer-left").children;
    var explorer_right_children = document.getElementById("explorer-right").children;

    for (var i = 0, len = explorer_left_children.length ; i < len; i++) {
        explorer_left_ids.push(explorer_left_children[i].id);
    }
    for (var i = 0, len = explorer_right_children.length ; i < len; i++) {
        explorer_right_ids.push(explorer_right_children[i].id);
    }
    console.log(explorer_left_ids, explorer_right_ids);
    return explorer_right_ids.slice(1)
};
</script>

<script> window.onload = StartTrackerData ();</script>
</body>
</html>
